"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TelegramNotifier = void 0;
const telegraf_1 = require("telegraf");
class TelegramNotifier {
    bot;
    chatIds;
    constructor(botToken, chatIds) {
        this.bot = new telegraf_1.Telegraf(botToken);
        this.chatIds = chatIds.split(',').map(id => id.trim());
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º—ã
     */
    async sendSystemStarted() {
        const message = `üöÄ *–°–ò–°–¢–ï–ú–ê –ó–ê–ü–£–©–ï–ù–ê*

üìä *–°—Ç–∞—Ç—É—Å:* –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –∞–∫—Ç–∏–≤–µ–Ω
üéØ *–°—Ç—Ä–∞—Ç–µ–≥–∏—è:* –ü–æ–∏—Å–∫ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–∏–Ω–∏–º—É–º–æ–≤
ü§ñ *LLM:* –í–∫–ª—é—á–µ–Ω
üì± *Telegram:* –í–∫–ª—é—á–µ–Ω

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!`;
        await this.sendToAllChats(message);
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Å–¥–µ–ª–∫–∏
     */
    async sendTradeAnalysis(symbol, action, price, confidence, reasoning, patterns, marketConditions, recommendation) {
        const emoji = action === 'BUY' ? 'üü¢' : action === 'SELL' ? 'üî¥' : 'üü°';
        const patternsText = patterns.length > 0 ? patterns.join(', ') : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã';
        const conditionsText = marketConditions.length > 0 ? marketConditions.join(', ') : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã';
        const message = `${emoji} *${action} –°–ò–ì–ù–ê–õ - ${symbol}*

üí∞ *–¶–µ–Ω–∞:* $${price.toFixed(4)}
üéØ *–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:* ${confidence}%
üìä *–ü–∞—Ç—Ç–µ—Ä–Ω—ã:* ${patternsText}
üåç *–£—Å–ª–æ–≤–∏—è —Ä—ã–Ω–∫–∞:* ${conditionsText}

üß† *LLM –ê–ù–ê–õ–ò–ó:*
${reasoning}

üí° *–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:*
${recommendation}`;
        await this.sendToAllChats(message);
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ —Ä—ã–Ω–∫–µ
     */
    async sendMarketReport(totalTrades, winRate, profitFactor, bestPattern, currentTrend, recommendations) {
        const recommendationsText = recommendations.length > 0
            ? recommendations.map((rec, i) => `${i + 1}. ${rec}`).join('\n')
            : '–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π';
        const message = `üìä *–û–¢–ß–ï–¢ –û –†–´–ù–ö–ï*

üìà *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*
‚Ä¢ –°–¥–µ–ª–æ–∫: ${totalTrades}
‚Ä¢ –í–∏–Ω—Ä–µ–π—Ç: ${winRate.toFixed(1)}%
‚Ä¢ Profit Factor: ${profitFactor.toFixed(2)}

üéØ *–ü–∞—Ç—Ç–µ—Ä–Ω—ã:*
‚Ä¢ –õ—É—á—à–∏–π: ${bestPattern}
‚Ä¢ –¢—Ä–µ–Ω–¥: ${currentTrend}

üí° *–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
${recommendationsText}`;
        await this.sendToAllChats(message);
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å LLM –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
     */
    async sendLLMCommentary(title, marketOverview, tradingOpportunities, riskAssessment, recommendations) {
        const opportunitiesText = tradingOpportunities.length > 0
            ? tradingOpportunities.map((opp, i) => `${i + 1}. ${opp}`).join('\n')
            : '–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π';
        const recommendationsText = recommendations.length > 0
            ? recommendations.map((rec, i) => `${i + 1}. ${rec}`).join('\n')
            : '–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π';
        const message = `üß† *${title}*

üåç *–û–ë–ó–û–† –†–´–ù–ö–ê:*
${marketOverview}

üéØ *–¢–û–†–ì–û–í–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:*
${opportunitiesText}

‚ö†Ô∏è *–û–¶–ï–ù–ö–ê –†–ò–°–ö–û–í:*
${riskAssessment}

üí° *–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
${recommendationsText}`;
        await this.sendToAllChats(message);
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É
     */
    async sendError(title, message) {
        const errorMessage = `‚ùå *${title}*

${message}

üïê *–í—Ä–µ–º—è:* ${new Date().toLocaleString('ru-RU')}`;
        await this.sendToAllChats(errorMessage);
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
     */
    async sendTestMessage() {
        const message = `üß™ *–¢–ï–°–¢–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï*

‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
üïê –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}`;
        await this.sendToAllChats(message);
    }
    /**
     * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–µ —á–∞—Ç—ã
     */
    async sendToAllChats(message) {
        for (const chatId of this.chatIds) {
            try {
                await this.bot.telegram.sendMessage(chatId, message, {
                    parse_mode: 'Markdown',
                });
                console.log(`üì± –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç ${chatId}`);
            }
            catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —á–∞—Ç ${chatId}:`, error);
            }
        }
    }
}
exports.TelegramNotifier = TelegramNotifier;
//# sourceMappingURL=telegram-notifier.js.map